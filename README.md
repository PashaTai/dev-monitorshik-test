# Unified Monitor

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏–∑ VK –∏ Telegram —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä—É—á–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏–∑ VK –∏ Telegram –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å –ø–æ–º–æ—â—å—é Yandex GPT
- üè∑Ô∏è –†—É—á–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- üìà –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –¥–∏–Ω–∞–º–∏–∫–∏ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- üíæ –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ SQLite
- üîí –ó–∞—â–∏—â–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ dashboard

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

1. **–ú–æ–Ω–∏—Ç–æ—Ä—ã** (`main.py`) - —Å–æ–±–∏—Ä–∞—é—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–∑ VK –∏ Telegram
2. **API —Å–µ—Ä–≤–µ—Ä** (`api_server.py`) - REST API –¥–ª—è —Ä—É—á–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
3. **Dashboard** (`dashboard/streamlit_app.py`) - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ —Ä–∞–∑–º–µ—Ç–∫–∏

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <your-repo-url>
cd unified-monitor

# –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate  # Windows

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```bash
cp env.example .env
nano .env  # –∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
```

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

**–î–ª—è VK –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
- `VK_ACCESS_TOKEN` - —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ VK (https://vk.com/apps?act=manage)
- `VK_GROUP_ID` - ID –≥—Ä—É–ø–ø—ã –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–î–ª—è Telegram –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
- `TG_API_ID` - API ID –∏–∑ https://my.telegram.org
- `TG_API_HASH` - API Hash –∏–∑ https://my.telegram.org
- `TG_STRING_SESSION` - –ø–æ–ª—É—á–∏—Ç–µ —á–µ—Ä–µ–∑ `python generate_session.py`
- `CHANNELS` - —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–±–µ–∑ @)

**–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:**
- `YANDEX_API_KEY` - API –∫–ª—é—á Yandex Cloud
- `YANDEX_FOLDER_ID` - ID –ø–∞–ø–∫–∏ Yandex Cloud

**–î–ª—è —Ä—É—á–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏:**
- `API_USERNAME` - –ª–æ–≥–∏–Ω –¥–ª—è API (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: admin)
- `API_PASSWORD` - –ø–∞—Ä–æ–ª—å –¥–ª—è API
- `DASHBOARD_PASSWORD` - –ø–∞—Ä–æ–ª—å –¥–ª—è dashboard

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ Telegram Session

–î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Telegram –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª—É—á–∏—Ç—å StringSession:

```bash
python generate_session.py
```

–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ –∫–æ–Ω—Å–æ–ª–∏ –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π StringSession –≤ `.env`.

### 4. –ó–∞–ø—É—Å–∫

#### –õ–æ–∫–∞–ª—å–Ω–æ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏):

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –ú–æ–Ω–∏—Ç–æ—Ä—ã
python main.py

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: API —Å–µ—Ä–≤–µ—Ä
python api_server.py

# –¢–µ—Ä–º–∏–Ω–∞–ª 3: Dashboard
streamlit run dashboard/streamlit_app.py
```

#### –ù–∞ VPS (production):

–°–º. –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –≤ [DEPLOYMENT.md](DEPLOYMENT.md)

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ dashboard –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://your-server:8501`
2. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å (–∏–∑ `DASHBOARD_PASSWORD`)
3. –ò–∑—É—á–∞–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –†—É—á–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞

1. –í dashboard –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Å–µ–∫—Ü–∏—é "–†—É—á–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏"
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –¥–ª—è —Ä–∞–∑–º–µ—Ç–∫–∏
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
   - üü¢ –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π
   - ‚ö™ –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π
   - üî¥ –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π
4. –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ API

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
unified-monitor/
‚îú‚îÄ‚îÄ api_server.py           # REST API –¥–ª—è —Ä—É—á–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏
‚îú‚îÄ‚îÄ main.py                 # –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚îú‚îÄ‚îÄ generate_session.py     # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Telegram session
‚îú‚îÄ‚îÄ requirements.txt        # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ env.example             # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ db.md                   # –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ settings.py         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ db_manager.py       # –ú–µ–Ω–µ–¥–∂–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ models.py           # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ monitors/
‚îÇ   ‚îú‚îÄ‚îÄ telegram_monitor.py # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Telegram
‚îÇ   ‚îî‚îÄ‚îÄ vk_monitor.py       # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ VK
‚îú‚îÄ‚îÄ sentiment/
‚îÇ   ‚îî‚îÄ‚îÄ yandex_analyzer.py  # –ê–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îî‚îÄ‚îÄ streamlit_app.py    # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îî‚îÄ‚îÄ deploy/
    ‚îú‚îÄ‚îÄ unified-monitor.service
    ‚îú‚îÄ‚îÄ sentiment-api.service
    ‚îú‚îÄ‚îÄ sentiment-dashboard.service
    ‚îî‚îÄ‚îÄ deploy.sh
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –≤ —Ñ–∞–π–ª–µ `comments.db`.

–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –æ–ø–∏—Å–∞–Ω–∞ –≤ [db.md](db.md).

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è:

- `id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
- `source` - –∏—Å—Ç–æ—á–Ω–∏–∫ (telegram/vk)
- `comment_text` - —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
- `sentiment` - —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (positive/negative/neutral/NULL)
- `sentiment_score` - —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ (0.0-1.0)
- `processed` - —Ñ–ª–∞–≥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (0/1)

### –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ SQL:

```bash
sqlite3 comments.db

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
SELECT sentiment, COUNT(*) FROM comments GROUP BY sentiment;

# –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
SELECT COUNT(*) FROM comments WHERE sentiment IS NULL;
```

## API Endpoints

API —Å–µ—Ä–≤–µ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ endpoints:

- `GET /api/health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- `GET /api/comments/undefined` - —Å–ø–∏—Å–æ–∫ –Ω–µ—Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- `PUT /api/comments/{id}/sentiment` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- `GET /api/comments/{id}` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
- `GET /api/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–í—Å–µ endpoints —Ç—Ä–µ–±—É—é—Ç HTTP Basic Auth (username/password –∏–∑ `.env`).

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.9+
- SQLite 3
- –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –¥–ª—è API Yandex Cloud
- (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) VPS —Å–µ—Ä–≤–µ—Ä –¥–ª—è production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

- `logs/unified-monitor.log` - –ª–æ–≥–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- `logs/unified-monitor-errors.log` - —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
- `comments.db` - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
